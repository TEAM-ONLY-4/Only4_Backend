version: '3.8'

services:
  # [API 서버 컨테이너]
  api-server:
    container_name: only4-api
    # ECR에서 이미지를 당겨옵니다
    image: ${ECR_REGISTRY}/only4-be:latest
    restart: always
    ports:
      - "8080:8080" # 호스트 8080 -> 컨테이너 8080

    # 호스트(EC2)의 .env 파일 내용을 컨테이너 환경변수로 주입
    env_file:
      - .env

    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_BATCH_JOB_ENABLED=false

    # [추가 권장] 로그 로테이션 설정 (디스크 폭발 방지)
    logging:
      driver: "json-file"
      options:
        max-size: "10m" # 로그 파일 하나당 최대 10MB
        max-file: "3"   # 최대 3개까지만 보관 (총 30MB 유지)