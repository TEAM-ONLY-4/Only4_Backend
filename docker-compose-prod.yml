version: '3.8'

services:
  api-server:
    container_name: only4-api
    # [수정] latest 대신 변수를 사용하여 방금 배포한 이미지를 정확히 가리킵니다.
    image: ${ECR_REGISTRY}/only4-deploy:${IMAGE_TAG}
    restart: always
    ports:
      - "8080:8080"

    # .env 파일의 모든 변수를 컨테이너 내부로 주입
    env_file:
      - .env

    # 필수적인 스프링 설정만 명시 (기타 DB/Kafka 정보는 .env에서 알아서 들어감)
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_BATCH_JOB_ENABLED=false

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"